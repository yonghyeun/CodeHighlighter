import { toSvg } from "html-to-image";

export const DownLoadSnippetToSVGButton = () => {
  const handleDownload = async () => {
    const $codeBlock = document.querySelector("pre");
    if (!$codeBlock) {
      return;
    }

    /* 스크롤바 없애기 전 저장 */
    const originalWidth = $codeBlock.style.width;
    const originalOverflowX = $codeBlock.style.overflowX;
    try {
      /* 스크롤바 없애기  */
      $codeBlock.style.width = "fit-content";
      $codeBlock.style.overflow = "visible";

      const svgData = await toSvg($codeBlock, {
        quality: 1,
        pixelRatio: 2,
      });

      const link = document.createElement("a");
      link.href = svgData;
      link.download = "code.svg";
      link.click();
    } catch (error) {
      console.error(error);
    } finally {
      /* 스크롤바 복원  */
      $codeBlock.style.width = originalWidth;
      $codeBlock.style.overflowX = originalOverflowX;
    }
  };

  return (
    <button
      className="bg-slate-700 rounded-xl text-xl  flex items-center px-4 py-2  mb-2 transition-transform duration-300 ease-in-out hover:scale-110"
      onClick={handleDownload}
    >
      <DownloadIcon />
      <p className="ml-2 text-sm">Download Image</p>
    </button>
  );
};

const DownloadIcon = () => (
  <svg
    width="1rem"
    height="1rem"
    viewBox="0 0 61 61"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clipPath="url(#clip0_96_12)">
      <path
        d="M49.5502 0.291626H12.0502C9.06649 0.291626 6.205 1.47689 4.09522 3.58667C1.98544 5.69646 0.800171 8.55794 0.800171 11.5416L0.800171 49.0416C0.800171 52.0253 1.98544 54.8868 4.09522 56.9966C6.205 59.1064 9.06649 60.2916 12.0502 60.2916H49.5502C52.5339 60.2916 55.3953 59.1064 57.5051 56.9966C59.6149 54.8868 60.8002 52.0253 60.8002 49.0416V11.5416C60.8002 8.55794 59.6149 5.69646 57.5051 3.58667C55.3953 1.47689 52.5339 0.291626 49.5502 0.291626ZM38.3002 4.04163V9.66663C38.3002 10.1639 38.4977 10.6408 38.8493 10.9925C39.201 11.3441 39.6779 11.5416 40.1752 11.5416C40.6725 11.5416 41.1494 11.3441 41.501 10.9925C41.8526 10.6408 42.0502 10.1639 42.0502 9.66663V4.04163H43.9252V17.1666H17.6752V4.04163H38.3002ZM57.0502 49.0416C57.0502 51.0307 56.26 52.9384 54.8535 54.3449C53.4469 55.7514 51.5393 56.5416 49.5502 56.5416H12.0502C10.061 56.5416 8.15339 55.7514 6.74687 54.3449C5.34035 52.9384 4.55017 51.0307 4.55017 49.0416V11.5416C4.55017 9.5525 5.34035 7.64485 6.74687 6.23833C8.15339 4.8318 10.061 4.04163 12.0502 4.04163H13.9252V19.0416C13.9252 19.5389 14.1227 20.0158 14.4743 20.3675C14.826 20.7191 15.3029 20.9166 15.8002 20.9166H45.8002C46.2975 20.9166 46.7744 20.7191 47.126 20.3675C47.4776 20.0158 47.6752 19.5389 47.6752 19.0416V4.04163H49.5502C51.5393 4.04163 53.4469 4.8318 54.8535 6.23833C56.26 7.64485 57.0502 9.5525 57.0502 11.5416V49.0416ZM45.8002 26.5416H15.8002C15.3029 26.5416 14.826 26.7392 14.4743 27.0908C14.1227 27.4424 13.9252 27.9193 13.9252 28.4166V50.9166C13.9252 51.4139 14.1227 51.8908 14.4743 52.2425C14.826 52.5941 15.3029 52.7916 15.8002 52.7916H45.8002C46.2975 52.7916 46.7744 52.5941 47.126 52.2425C47.4776 51.8908 47.6752 51.4139 47.6752 50.9166V28.4166C47.6752 27.9193 47.4776 27.4424 47.126 27.0908C46.7744 26.7392 46.2975 26.5416 45.8002 26.5416ZM43.9252 49.0416H17.6752V30.2916H43.9252V49.0416ZM23.3002 37.7916H38.3002C38.7975 37.7916 39.2744 37.5941 39.626 37.2425C39.9776 36.8908 40.1752 36.4139 40.1752 35.9166C40.1752 35.4193 39.9776 34.9424 39.626 34.5908C39.2744 34.2392 38.7975 34.0416 38.3002 34.0416H23.3002C22.8029 34.0416 22.326 34.2392 21.9743 34.5908C21.6227 34.9424 21.4252 35.4193 21.4252 35.9166C21.4252 36.4139 21.6227 36.8908 21.9743 37.2425C22.326 37.5941 22.8029 37.7916 23.3002 37.7916ZM23.3002 45.2916H38.3002C38.7975 45.2916 39.2744 45.0941 39.626 44.7425C39.9776 44.3908 40.1752 43.9139 40.1752 43.4166C40.1752 42.9193 39.9776 42.4424 39.626 42.0908C39.2744 41.7392 38.7975 41.5416 38.3002 41.5416H23.3002C22.8029 41.5416 22.326 41.7392 21.9743 42.0908C21.6227 42.4424 21.4252 42.9193 21.4252 43.4166C21.4252 43.9139 21.6227 44.3908 21.9743 44.7425C22.326 45.0941 22.8029 45.2916 23.3002 45.2916Z"
        fill="white"
      />
    </g>
    <defs>
      <clipPath id="clip0_96_12">
        <rect
          width="60"
          height="60"
          fill="white"
          transform="translate(0.800171 0.291626)"
        />
      </clipPath>
    </defs>
  </svg>
);
